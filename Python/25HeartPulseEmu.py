from socketIO_client import SocketIO, LoggingNamespace


import math

pulA = [0.22388393856624728, 59.68745802176152, 59.642681234048275, 53.95602919446559, 59.68745802176152, 58.25460081493754, 59.642681234048275, 56.82174360811356, 58.25460081493754, 57.53817221152555, 61.79196704428425, 56.82174360811356, 63.98602964223347, 63.26960103882148, 60.40388662517351, 61.120315228585504, 61.836743831997495, 60.40388662517351, 61.836743831997495, 63.98602964223347, 60.40388662517351, 64.70245824564546, 61.836743831997495, 63.26960103882148, 65.41888684905746, 60.40388662517351, 58.25460081493754, 62.553172435409486, 61.79196704428425, 56.82174360811356, 59.68745802176152, 59.68745802176152, 62.553172435409486, 60.448663412886766, 74.95634263197958, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.08955357542649892, 33.0452693323781, 31.657188913267365, 37.3886177405633, 41.73196614874849, 48.17982357945641, 52.43361841221511, 38.866251735100526, 49.61268078628039, 53.95602919446559, 57.4933954238123, 56.06053821698832, 54.62768101016434, 53.194823803340356, 53.91125240675235, 46.74696637263243, 53.1500470156271, 43.16482335557247, 49.61268078628039, 50.329109389692384, 53.91125240675235, 53.194823803340356, 56.06053821698832, 56.06053821698832, 56.77696682040031, 56.82174360811356, 58.20982402722429, 56.77696682040031, 55.388886401289575, 57.53817221152555, 58.25460081493754, 58.97102941834953, 58.97102941834953, 59.68745802176152, 60.40388662517351, 60.40388662517351, 57.53817221152555, 61.120315228585504, 66.13531545246944, 62.553172435409486, 61.836743831997495, 61.836743831997495, 61.120315228585504, 0, 0, 0, 0, 0]
pulB = [62.553172435409486, 64.70245824564546, 61.836743831997495, 63.26960103882148, 63.98602964223347, 62.553172435409486, 63.26960103882148, 63.26960103882148, 63.26960103882148, 62.553172435409486, 63.26960103882148, 62.553172435409486, 63.98602964223347, 63.26960103882148, 61.836743831997495, 62.553172435409486, 62.553172435409486, 63.26960103882148, 63.26960103882148, 63.26960103882148, 63.26960103882148, 61.836743831997495, 63.26960103882148, 63.98602964223347, 64.70245824564546, 66.13531545246944, 64.70245824564546, 64.70245824564546, 63.26960103882148, 66.13531545246944, 61.836743831997495, 61.836743831997495, 61.836743831997495, 63.26960103882148, 66.13531545246944, 63.26960103882148, 63.98602964223347, 60.40388662517351, 61.836743831997495, 62.553172435409486, 63.26960103882148, 65.41888684905746, 63.98602964223347, 65.41888684905746, 63.26960103882148, 63.26960103882148, 63.98602964223347, 63.98602964223347, 63.98602964223347, 63.98602964223347, 64.70245824564546, 63.98602964223347, 63.26960103882148, 65.41888684905746, 63.26960103882148, 63.98602964223347, 63.98602964223347, 63.26960103882148, 65.41888684905746, 63.98602964223347, 60.40388662517351, 61.120315228585504, 63.26960103882148, 64.70245824564546, 63.98602964223347, 63.26960103882148, 63.98602964223347, 63.26960103882148, 63.98602964223347, 63.26960103882148, 63.98602964223347, 62.553172435409486, 62.553172435409486, 63.98602964223347, 63.26960103882148, 63.26960103882148, 63.98602964223347, 63.26960103882148, 63.26960103882148, 63.98602964223347, 63.98602964223347, 63.98602964223347, 63.26960103882148, 63.98602964223347, 64.70245824564546, 63.26960103882148, 63.98602964223347, 63.98602964223347, 63.98602964223347, 63.26960103882148, 63.26960103882148, 63.26960103882148, 0]
pulC = [65.41888684905746, 64.70245824564546, 66.13531545246944, 63.98602964223347, 66.13531545246944, 67.56817265929342, 60.40388662517351, 68.32937805041867, 69.04580665383065, 69.7174584695294, 66.85174405588144, 67.61294944700667, 76.21009268795058, 69.7174584695294, 66.85174405588144, 62.553172435409486, 63.26960103882148, 63.98602964223347, 63.26960103882148, 62.553172435409486, 63.26960103882148, 66.13531545246944, 64.70245824564546, 63.26960103882148, 63.26960103882148, 63.26960103882148, 63.98602964223347, 63.98602964223347, 63.26960103882148, 63.98602964223347, 63.26960103882148, 63.98602964223347, 63.98602964223347, 66.13531545246944, 62.553172435409486, 63.26960103882148, 63.98602964223347, 65.41888684905746, 65.41888684905746, 63.98602964223347, 63.98602964223347, 63.98602964223347, 66.85174405588144, 62.553172435409486, 63.26960103882148, 63.26960103882148, 66.13531545246944, 61.836743831997495, 63.26960103882148, 62.553172435409486, 65.41888684905746, 63.26960103882148, 63.98602964223347, 63.26960103882148, 66.13531545246944, 63.98602964223347, 63.26960103882148, 61.120315228585504, 63.26960103882148, 62.553172435409486, 63.98602964223347, 63.26960103882148, 63.98602964223347, 62.553172435409486, 63.26960103882148, 63.26960103882148, 63.98602964223347, 63.26960103882148, 63.98602964223347, 65.41888684905746, 63.98602964223347, 65.41888684905746, 62.553172435409486, 65.41888684905746, 63.98602964223347, 62.553172435409486, 64.70245824564546, 65.41888684905746, 66.13531545246944, 66.85174405588144, 62.553172435409486, 62.553172435409486, 68.28460126270542, 65.4636636367707, 69.67268168181616, 56.105315004701566, 60.40388662517351, 67.56817265929342, 58.25460081493754, 65.41888684905746, 64.70245824564546, 0, 0]
pulD = [66.13531545246944, 63.26960103882148, 63.98602964223347, 63.98602964223347, 65.41888684905746, 63.98602964223347, 65.41888684905746, 65.41888684905746, 64.70245824564546, 63.26960103882148, 63.26960103882148, 61.836743831997495, 65.41888684905746, 63.26960103882148, 62.553172435409486, 60.40388662517351, 66.85174405588144, 60.40388662517351, 64.70245824564546, 64.70245824564546, 66.13531545246944, 65.41888684905746, 67.56817265929342, 62.553172435409486, 66.13531545246944, 60.40388662517351, 61.836743831997495, 63.26960103882148, 61.836743831997495, 63.26960103882148, 64.70245824564546, 64.70245824564546, 66.13531545246944, 63.98602964223347, 61.120315228585504, 66.13531545246944, 63.31437782653473, 73.29960148658935, 59.68745802176152, 62.553172435409486, 63.26960103882148, 66.85174405588144, 61.836743831997495, 63.26960103882148, 61.120315228585504, 63.98602964223347, 61.120315228585504, 63.26960103882148, 64.70245824564546, 64.70245824564546, 63.26960103882148, 63.26960103882148, 62.553172435409486, 64.70245824564546, 61.836743831997495, 63.26960103882148, 63.26960103882148, 63.26960103882148, 65.41888684905746, 63.26960103882148, 64.70245824564546, 63.98602964223347, 63.98602964223347, 62.553172435409486, 64.70245824564546, 63.26960103882148, 63.98602964223347, 62.553172435409486, 65.41888684905746, 62.553172435409486, 63.26960103882148, 63.26960103882148, 64.70245824564546, 62.553172435409486, 66.13531545246944, 62.553172435409486, 66.13531545246944, 62.553172435409486, 63.26960103882148, 64.7472350333587, 69.0010298661174, 63.26960103882148, 61.836743831997495, 66.13531545246944, 66.13531545246944, 63.26960103882148, 62.553172435409486, 65.41888684905746, 64.70245824564546, 65.41888684905746, 65.41888684905746, 64.70245824564546, 0]
pulE = [63.26960103882148, 63.98602964223347, 66.85174405588144, 63.26960103882148, 63.26960103882148, 63.26960103882148, 67.56817265929342, 63.98602964223347, 63.98602964223347, 63.26960103882148, 65.41888684905746, 63.98602964223347, 65.41888684905746, 63.26960103882148, 64.70245824564546, 65.41888684905746, 62.553172435409486, 63.26960103882148, 63.31437782653473, 69.7174584695294, 61.836743831997495, 64.70245824564546, 63.26960103882148, 64.70245824564546, 65.41888684905746, 63.98602964223347, 63.98602964223347, 63.98602964223347, 67.56817265929342, 63.26960103882148, 64.70245824564546, 63.26960103882148, 67.56817265929342, 63.26960103882148, 63.98602964223347, 64.7472350333587, 69.7174584695294, 63.98602964223347, 66.13531545246944, 63.31437782653473, 69.0010298661174, 64.7472350333587, 69.04580665383065, 75.67277123539158, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 82.70272690637174, 80.55344109613577, 80.50866430842252, 79.79223570501053, 78.35937849818654, 79.79223570501053, 77.64294989477456, 78.35937849818654, 75.49366408453858, 74.0608068777146, 70.47866386065463, 74.0608068777146, 72.58317288317737, 61.16509201629876, 69.04580665383065, 69.76223525724265, 69.76223525724265, 69.76223525724265, 69.76223525724265, 69.76223525724265, 69.04580665383065, 69.04580665383065, 69.0010298661174, 68.28460126270542, 68.28460126270542, 68.32937805041867, 69.04580665383065, 69.76223525724265, 69.0010298661174, 66.13531545246944, 67.56817265929342, 68.28460126270542, 67.56817265929342, 67.56817265929342, 68.28460126270542, 67.56817265929342, 66.13531545246944, 0]
pulOFF = [64.70245824564546, 63.98602964223347, 63.98602964223347, 64.70245824564546, 63.26960103882148, 64.70245824564546, 63.98602964223347, 64.70245824564546, 63.26960103882148, 63.26960103882148, 63.26960103882148, 64.70245824564546, 63.26960103882148, 63.98602964223347, 63.98602964223347, 63.98602964223347, 63.98602964223347, 63.98602964223347, 64.70245824564546, 63.26960103882148, 63.26960103882148, 63.98602964223347, 63.98602964223347, 63.26960103882148, 63.98602964223347, 63.98602964223347, 63.26960103882148, 63.98602964223347, 63.98602964223347, 63.26960103882148, 63.26960103882148, 63.98602964223347, 63.98602964223347, 63.98602964223347, 63.26960103882148, 63.26960103882148, 63.26960103882148, 63.26960103882148, 64.70245824564546, 63.26960103882148, 63.26960103882148, 63.98602964223347, 63.98602964223347, 63.26960103882148, 63.26960103882148, 63.26960103882148, 63.26960103882148, 63.26960103882148, 63.98602964223347, 63.26960103882148, 63.98602964223347, 63.26960103882148, 63.26960103882148, 63.26960103882148, 63.98602964223347, 63.26960103882148, 63.26960103882148, 63.98602964223347, 63.98602964223347, 63.26960103882148, 63.26960103882148, 63.26960103882148, 63.26960103882148, 63.98602964223347, 63.26960103882148, 63.26960103882148, 63.26960103882148, 63.26960103882148, 63.26960103882148, 63.98602964223347, 63.98602964223347, 63.98602964223347, 63.26960103882148, 63.98602964223347, 65.41888684905746, 63.98602964223347, 63.98602964223347, 63.98602964223347, 63.98602964223347, 63.98602964223347, 63.98602964223347, 63.98602964223347, 63.26960103882148, 63.98602964223347, 63.98602964223347, 64.70245824564546, 63.98602964223347, 63.26960103882148, 63.98602964223347, 63.26960103882148, 63.98602964223347, 63.98602964223347, 0]
#n = len(pul)-10 /// EVERY 150 seconds
# 64 // 76~77 , 64
# 64.2857142857 <- 70%
count = 0
gaps = []

def RelevantForBPM(array):
    temp = []
    for i in range(len(array)):
        if( array[i] > 2 and array[i] < 90 ):
            temp.append(array[i])
    return temp


def byCounting(pulseArray):
    array_ = RelevantForBPM(pulseArray)
    i = 0
    counts = 0
    while i+1 < len(array_):
        if ((array_[i] > 64.2857142857) and (array_[i+1] < 64.2857142857)):
            counts += 1
            print (i,array_[i],i+1,array_[i+1],counts)
            i +=1
        i+=1
    counts *= 4
    return counts

def byGAPS(pulseArray):
    array_ = RelevantForBPM(pulseArray)
    i = 0
    legitBPMs = []
    while i + 1 < len(array_):
        if ((array_[i] > 64.2857142857) and (array_[i + 1] < 64.2857142857)):
            j = i+2
            while j+1 < len(array_):
                if ((array_[j] > 64.2857142857) and (array_[j + 1] < 64.2857142857)):
                    gap = j-(i+2)
                    BPM_byGAP = 0
                    if gap != 0:
                        BPM_byGAP = math.floor(60/(gap*0.150))
                        if BPM_byGAP < 200 and BPM_byGAP > 35:
                            legitBPMs.append(BPM_byGAP)
                    print (i,j,'gap : ',gap,'bpm by gap: ',BPM_byGAP)
                    break
                j += 1
        i += 1
    return legitBPMs

def has_QRS_complex(i,array):
    if i+2 >= len(array):
        return 0
    if array[i+1] > array[i] and array[i+1] > 64.2857142857 :
        if array[i+2] < 64.2857142857:
            return 1
    return 0

#_______________________________________________________#

currentArray = pulC
BPM_byCounting = byCounting(currentArray)
BPMS_byGaps = byGAPS(currentArray)

print '___________RESULTS : ____________________________________________'

print BPM_byCounting
for i in range(len(BPMS_byGaps)):
    print BPMS_byGaps[i]